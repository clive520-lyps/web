<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è‹±èªæ¯é€±ä¸€å¥</title>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* --- ç‰ˆé¢æ¨£å¼ (æ ¹æ“šä¸Šå‚³æª”æ¡ˆèª¿æ•´) --- */
    :root {
      --bg: #f0f8ff;
      --accent: #ff6b6b;
      --card-left: #4dabf7;
      --english: #1864ab;
      --chinese: #5f3dc4;
    }

    html,body{
      height:100%;
      margin:0;
      padding:0;
    }

    body {
      font-family: 'Comic Sans MS','æ¨™æ¥·é«”',sans-serif;
      background-color: var(--bg);
      text-align: center;
      padding: 20px;
      background-image: url('https://img.freepik.com/free-vector/hand-drawn-school-background_23-2149464866.jpg');
      background-size: cover;
      background-attachment: fixed;
      color: #333;
      position: relative;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.15);
      border: 5px solid var(--accent);
      position: relative;
    }

    h1 {
      color: var(--accent);
      font-size: 2.4rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.08);
    }

    p.subtitle {
      margin-top:0;
      margin-bottom:18px;
      font-size:1rem;
      color:#444;
    }

    .phrase-card {
      background-color: #fffacd;
      padding: 22px;
      border-radius: 15px;
      margin: 18px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
      border-left: 10px solid var(--card-left);
    }

    .english-phrase, .chinese-meaning {
      /* èª¿æ•´å­—é«”å¤§å°ä»¥é©æ‡‰æ›´å¤šæ–‡å­— */
      font-size: 1rem;
      /* è®“æ–‡å­—å¯ä»¥æ›è¡Œ */
      white-space: pre-line;
      margin: 12px 0;
      font-weight: 400;
      text-align: left; /* è®“å¤šè¡Œæ–‡å­—æ›´æ˜“è®€ */
    }

    .english-phrase {
      color: var(--english);
    }

    .chinese-meaning {
      color: var(--chinese);
    }
    .week-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #d0ebff;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
      font-weight: bold;
      gap: 10px;
      flex-wrap:wrap;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 22px;
      gap:12px;
    }

    button {
      background-color: var(--card-left);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 50px;
      font-size: 1.05rem;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      font-family: 'Comic Sans MS', sans-serif;
    }

    button:hover { background-color:#228be6; transform:translateY(-2px); }
    button:disabled { background-color:#adb5bd; cursor:not-allowed; transform:none; }

    .decoration {
      position: absolute;
      font-size: 1.6rem;
      pointer-events: none;
      opacity: 0.9;
    }
    .star1 { top: 24px; left: 18px; color: #ffd43b; transform: rotate(30deg); }
    .star2 { top: 82px; right: 34px; color: #ff8787; transform: rotate(-20deg); }
    .star3 { bottom: 72px; left: 36px; color: #74b816; transform: rotate(15deg); }
    .star4 { bottom: 120px; right: 48px; color: #9775fa; transform: rotate(-10deg); }

    .current-week {
      background-color: #ffec99;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 400;
    }

    @media (max-width:600px){
      .english-phrase { font-size:1.2rem; }
      .chinese-meaning { font-size:0.9rem; }
      .container { padding:18px; }
    }
  </style>
</head>
<body>
  <div class="decoration star1">â˜…</div>
  <div class="decoration star2">â˜…</div>
  <div class="decoration star3">â˜…</div>
  <div class="decoration star4">â˜…</div>

  <div class="container" role="main" aria-labelledby="main-title">
    <h1 id="main-title">ğŸ“š è‹±èªæ¯é€±ä¸€å¥ ğŸ“š</h1>
    <p class="subtitle">æ¯é€±å­¸ä¸€å¥å¯¦ç”¨è‹±èªï¼Œå¿«æ¨‚å­¸è‹±æ–‡ï¼</p>

    <div class="week-info" aria-live="polite">
      <div id="week-number"><span class="current-week">è¼‰å…¥ä¸­...</span></div>
      <div id="date-range">è¼‰å…¥ä¸­...</div>
    </div>

    <div class="phrase-card" aria-labelledby="english-phrase" aria-describedby="chinese-meaning">
      <div style="font-size:0.95rem; color:#666; font-weight:600;">æœ¬é€±è‹±èªå¥å­</div>
      <div id="english-phrase" class="english-phrase">è¼‰å…¥ä¸­...</div>
      <div id="chinese-meaning" class="chinese-meaning">è¼‰å…¥ä¸­...</div>
    </div>

    <div class="navigation" role="navigation" aria-label="é€±æ¬¡å°èˆª">
      <button id="prev-week" aria-label="ä¸Šä¸€é€±">â† ä¸Šä¸€é€±</button>
      <button id="next-week" aria-label="ä¸‹ä¸€é€±">ä¸‹ä¸€é€± â†’</button>
    </div>

    <div style="margin-top: 20px;">
      <a href="https://clive520-lyps.github.io/web/index.html" target="_blank" style="text-decoration: none; color: #4dabf7; font-weight: bold;">é–‹æ–°è¦–çª—</a>
      <a href="https://docs.google.com/spreadsheets/d/1XpMVyLbBLjP8W7Y25TGOan5H2-WDRsr3TZ6iAu-wY_8/edit?usp=sharing" target="_blank" style="text-decoration: none; color: #4dabf7; font-weight: bold;">ç·¨è¼¯å…§æ–‡</a>
    </div>

  </div>

<script>
  // æ ¼å¼åŒ–æ—¥æœŸç‚º YYYY-MM-DD ä»¥ä¾¿æ¯”å°
  function formatDateString(date) {
    const d = new Date(date);
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  // å¾ Google Apps Script ç²å–è³‡æ–™
  async function fetchPhrases() {
    try {
      const scriptUrl = 'https://script.google.com/macros/s/AKfycbzyKYp8DwIGigj323isz1X-0jY9uLJCtfZ1hMo2ZcvwFOKDgUIvP8eZSjMyLLEWTbMhXQ/exec';
      const res = await fetch(scriptUrl, { method: 'GET', cache: 'no-cache' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      return Array.isArray(data) ? data : [];
    } catch (err) {
      console.error('ç²å–æ•¸æ“šå¤±æ•—:', err);
      Swal.fire({
        title: 'éŒ¯èª¤!',
        text: 'ç„¡æ³•å–å¾—è³‡æ–™ï¼Œè«‹ç¢ºèª Apps Script æ˜¯å¦å·²éƒ¨ç½²ã€‚',
        icon: 'error'
      });
      return [];
    }
  }

  // é¡¯ç¤ºç‰¹å®šé€±æ¬¡çš„å¥å­
  function showWeek(index, phrases) {
    if (!phrases || index < 0 || index >= phrases.length) return;
    
    const phrase = phrases[index];
    
    // é¡¯ç¤ºé€±æ¬¡
    document.getElementById('week-number').innerHTML =
      `<span class="current-week">ç¬¬ ${phrase.week} é€±</span>`;

    // é¡¯ç¤ºè©¦ç®—è¡¨ä¸­çš„èµ·å§‹æ—¥æœŸï¼ˆB æ¬„ï¼‰
    const weekDate = phrase.date ? phrase.date.split('T')[0] : 'ç„¡æ—¥æœŸ';
    document.getElementById('date-range').textContent = `æœ¬é€±èµ·å§‹æ—¥æœŸ: ${weekDate}`;
    
    // è™•ç†æ›è¡Œç¬¦è™Ÿ
    document.getElementById('english-phrase').textContent =
      (phrase.english || 'ï¼ˆç„¡è‹±æ–‡å…§å®¹ï¼‰').replace(/\\n/g, '\n');
    document.getElementById('chinese-meaning').textContent =
      (phrase.chinese || 'ï¼ˆç„¡ä¸­æ–‡å…§å®¹ï¼‰').replace(/\\n/g, '\n');

    // ç¦ç”¨å°èˆªæŒ‰éˆ•
    document.getElementById('prev-week').disabled = index === 0;
    document.getElementById('next-week').disabled = index === phrases.length - 1;
  }

  // ç¨‹å¼ä¸»é«”
  async function main() {
    const phrases = await fetchPhrases();
    if (!phrases || phrases.length === 0) return;

    // ç¢ºä¿è³‡æ–™ä¾æ—¥æœŸæ’åº
    phrases.sort((a, b) => new Date(a.date) - new Date(b.date));

    const today = new Date();
    today.setHours(0, 0, 0, 0); // åªæ¯”å°æ—¥æœŸéƒ¨åˆ†

    // å°‹æ‰¾ã€Œç•¶å‰é€±ã€çš„é‚è¼¯ï¼š
    // å°‹æ‰¾æ—¥æœŸå°æ–¼ç­‰æ–¼ä»Šå¤©ï¼Œä¸”æœ€æ¥è¿‘ä»Šå¤©çš„é‚£ä¸€ç­†è³‡æ–™
    let currentWeekIndex = 0;
    for (let i = 0; i < phrases.length; i++) {
      const weekStartDate = new Date(phrases[i].date);
      if (weekStartDate <= today) {
        currentWeekIndex = i;
      } else {
        break; // å› ç‚ºå·²æ’åºï¼Œé‡åˆ°æ¯”ä»Šå¤©æ™šçš„æ—¥æœŸå°±è·³å‡º
      }
    }

    // åˆå§‹åŒ–é¡¯ç¤º
    showWeek(currentWeekIndex, phrases);

    // è¨­å®šæŒ‰éˆ•äº‹ä»¶ (é€™è£¡éœ€è¦è®Šæ•¸é–‰åŒ…è™•ç†æˆ–å­˜æˆå…¨åŸŸè®Šæ•¸)
    let activeIndex = currentWeekIndex;
    document.getElementById('prev-week').onclick = () => {
      if (activeIndex > 0) {
        activeIndex--;
        showWeek(activeIndex, phrases);
      }
    };

    document.getElementById('next-week').onclick = () => {
      if (activeIndex < phrases.length - 1) {
        activeIndex++;
        showWeek(activeIndex, phrases);
      }
    };
  }

  document.addEventListener('DOMContentLoaded', main);
</script>
</body>
</html>

